<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timeline Challenge: American History 1870-1928</title>
  <script>
    // SCORM 1.2 API Wrapper (inlined for standalone use)
    var SCORM = {
      API: null,
      initialized: false,
      findAPI: function(win) {
        var attempts = 0;
        while (win && !win.API && attempts < 10) {
          attempts++;
          if (win.opener && !win.opener.closed) { win = win.opener; }
          else if (win.parent && win.parent !== win) { win = win.parent; }
          else { break; }
        }
        return win ? win.API : null;
      },
      initialize: function() {
        this.API = this.findAPI(window);
        if (!this.API) { return false; }
        var result = this.API.LMSInitialize("");
        this.initialized = (result === "true" || result === true);
        if (this.initialized) { this.setStatus("incomplete"); }
        return this.initialized;
      },
      getValue: function(el) { if (!this.API) return ""; return this.API.LMSGetValue(el); },
      setValue: function(el, val) { if (!this.API) return true; return this.API.LMSSetValue(el, val); },
      commit: function() { if (!this.API) return true; return this.API.LMSCommit(""); },
      finish: function() { if (!this.API) return true; return this.API.LMSFinish(""); },
      getLearnerName: function() { return this.getValue("cmi.core.student_name") || "Learner"; },
      setStatus: function(s) { this.setValue("cmi.core.lesson_status", s); this.commit(); },
      setScore: function(s) {
        this.setValue("cmi.core.score.raw", s);
        this.setValue("cmi.core.score.min", 0);
        this.setValue("cmi.core.score.max", 100);
        this.commit();
      },
      complete: function(score) {
        if (score !== undefined) { this.setScore(score); this.setStatus(score >= 70 ? "passed" : "failed"); }
        else { this.setStatus("completed"); }
        this.commit();
      }
    };
    window.addEventListener("load", function() { SCORM.initialize(); });
    window.addEventListener("beforeunload", function() { SCORM.finish(); });
  </script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Georgia', 'Times New Roman', serif;
      background: linear-gradient(180deg, #002868 0%, #001a4d 100%);
      min-height: 100vh;
      color: #fff;
    }

    /* Decorative stars background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 200px;
      background-image: radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.3), transparent),
                        radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.2), transparent),
                        radial-gradient(2px 2px at 50px 160px, rgba(255,255,255,0.3), transparent),
                        radial-gradient(2px 2px at 90px 40px, rgba(255,255,255,0.2), transparent),
                        radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,0.3), transparent),
                        radial-gradient(2px 2px at 160px 120px, rgba(255,255,255,0.2), transparent);
      background-repeat: repeat;
      background-size: 200px 200px;
      pointer-events: none;
      z-index: 0;
    }

    /* Visually hidden but accessible to screen readers */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
      z-index: 1;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: normal;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header .subtitle {
      color: #daa520;
      font-style: italic;
      font-size: 1.2rem;
      letter-spacing: 1px;
    }

    .decorative-line {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .decorative-line::before,
    .decorative-line::after {
      content: '';
      height: 2px;
      width: 100px;
      background: linear-gradient(90deg, transparent, #daa520, transparent);
    }

    .star-icon {
      color: #daa520;
      font-size: 1.2rem;
    }

    /* Score display */
    .score-bar {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-bottom: 30px;
      padding: 15px 30px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .score-item {
      text-align: center;
    }

    .score-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(255,255,255,0.7);
      margin-bottom: 5px;
    }

    .score-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: #daa520;
    }

    /* Game area */
    .game-area {
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(218,165,32,0.3);
      border-radius: 12px;
      padding: 40px;
      margin-bottom: 30px;
    }

    /* Reference event card */
    .reference-event {
      background: linear-gradient(135deg, #8b0000 0%, #5c0000 100%);
      border: 3px solid #daa520;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      margin-bottom: 40px;
      position: relative;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .reference-label {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: #daa520;
      color: #002868;
      padding: 4px 20px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .reference-year {
      font-size: 3rem;
      font-weight: bold;
      color: #daa520;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .reference-title {
      font-size: 1.4rem;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .reference-description {
      font-size: 0.95rem;
      color: rgba(255,255,255,0.8);
      font-style: italic;
      max-width: 500px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* Question prompt */
    .question-prompt {
      text-align: center;
      margin-bottom: 30px;
    }

    .question-prompt p {
      font-size: 1.1rem;
      color: rgba(255,255,255,0.9);
      margin-bottom: 10px;
    }

    .mystery-event {
      font-size: 1.5rem;
      color: #fff;
      font-weight: bold;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      border: 2px dashed rgba(218,165,32,0.5);
    }

    /* Choice buttons */
    .choices {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    .choice-btn {
      flex: 1;
      max-width: 250px;
      padding: 25px 30px;
      border: 3px solid rgba(218,165,32,0.5);
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      color: #fff;
      font-family: inherit;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .choice-btn:hover {
      background: rgba(218,165,32,0.2);
      border-color: #daa520;
      transform: translateY(-3px);
    }

    .choice-btn:focus-visible {
      outline: 3px solid #fff;
      outline-offset: 3px;
      background: rgba(218,165,32,0.2);
      border-color: #daa520;
    }

    .choice-btn .arrow {
      font-size: 2rem;
    }

    .choice-btn .label {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      opacity: 0.8;
    }

    .choice-btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .choice-btn.correct {
      background: rgba(0, 100, 0, 0.4);
      border-color: #228b22;
    }

    .choice-btn.incorrect {
      background: rgba(139, 0, 0, 0.4);
      border-color: #8b0000;
    }

    /* Result display */
    .result-display {
      display: none;
      text-align: center;
      margin-top: 30px;
      padding: 25px;
      border-radius: 12px;
    }

    .result-display.show {
      display: block;
    }

    .result-display.correct {
      background: rgba(0, 100, 0, 0.3);
      border: 2px solid #228b22;
    }

    .result-display.incorrect {
      background: rgba(139, 0, 0, 0.3);
      border: 2px solid #8b0000;
    }

    .result-icon {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    .result-text {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    .result-explanation {
      font-size: 1rem;
      color: rgba(255,255,255,0.8);
      line-height: 1.6;
    }

    .result-year {
      font-weight: bold;
      color: #daa520;
    }

    .result-context {
      margin-top: 16px;
      padding: 16px 20px;
      background: rgba(255,255,255,0.08);
      border-left: 3px solid #daa520;
      border-radius: 0 8px 8px 0;
      text-align: left;
      font-size: 0.95rem;
      color: rgba(255,255,255,0.85);
      line-height: 1.7;
    }

    /* Next button */
    .next-btn {
      display: none;
      margin: 30px auto 0;
      padding: 15px 50px;
      background: linear-gradient(135deg, #886b10 0%, #6b5310 100%);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-family: inherit;
      font-size: 1.1rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .next-btn.show {
      display: block;
    }

    .next-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(218,165,32,0.4);
    }

    .next-btn:focus-visible {
      outline: 3px solid #fff;
      outline-offset: 3px;
    }

    /* Start screen */
    .start-screen {
      text-align: center;
      padding: 60px 40px;
    }

    .start-screen h2 {
      font-size: 2rem;
      margin-bottom: 20px;
      font-weight: normal;
    }

    .start-screen p {
      color: rgba(255,255,255,0.8);
      max-width: 500px;
      margin: 0 auto 30px;
      line-height: 1.8;
    }

    .start-btn {
      padding: 20px 60px;
      background: linear-gradient(135deg, #886b10 0%, #6b5310 100%);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-family: inherit;
      font-size: 1.3rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 3px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .start-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(218,165,32,0.4);
    }

    .start-btn:focus-visible {
      outline: 3px solid #fff;
      outline-offset: 3px;
    }

    /* End screen */
    .end-screen {
      display: none;
      text-align: center;
      padding: 60px 40px;
    }

    .end-screen.show {
      display: block;
    }

    .final-score {
      font-size: 5rem;
      font-weight: bold;
      color: #daa520;
      margin: 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .final-score span {
      font-size: 2rem;
      color: rgba(255,255,255,0.7);
    }

    .grade-badge {
      display: inline-block;
      padding: 10px 40px;
      background: linear-gradient(135deg, #886b10 0%, #6b5310 100%);
      border-radius: 30px;
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 30px;
    }

    .end-message {
      color: rgba(255,255,255,0.8);
      font-size: 1.1rem;
      max-width: 500px;
      margin: 0 auto 30px;
      line-height: 1.8;
    }

    .play-again-btn {
      padding: 15px 40px;
      background: transparent;
      border: 2px solid #daa520;
      border-radius: 8px;
      color: #daa520;
      font-family: inherit;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .play-again-btn:hover {
      background: rgba(218,165,32,0.2);
    }

    .play-again-btn:focus-visible {
      outline: 3px solid #fff;
      outline-offset: 3px;
    }

    /* Progress bar */
    .progress-container {
      margin-bottom: 30px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: rgba(255,255,255,0.7);
      margin-bottom: 8px;
    }

    .progress-bar {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #daa520, #e8c547);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    /* Leaderboard section */
    .leaderboard-section {
      margin-top: 40px;
      padding-top: 40px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .leaderboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .leaderboard-header h2 {
      font-size: 1.3rem;
      font-weight: normal;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .name-prompt {
      margin-top: 30px;
      padding: 25px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(218,165,32,0.3);
      border-radius: 10px;
      text-align: center;
    }

    .name-prompt label {
      display: block;
      font-size: 1rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 12px;
    }

    .name-prompt input {
      padding: 10px 16px;
      font-family: inherit;
      font-size: 1rem;
      border: 2px solid rgba(218,165,32,0.5);
      border-radius: 6px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      width: 200px;
      max-width: 100%;
    }

    .name-prompt input:focus {
      outline: none;
      border-color: #daa520;
      background: rgba(255,255,255,0.15);
    }

    .name-prompt button {
      margin-left: 10px;
      padding: 10px 24px;
      background: linear-gradient(135deg, #886b10 0%, #6b5310 100%);
      border: none;
      border-radius: 6px;
      color: #fff;
      font-family: inherit;
      font-size: 1rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .name-prompt button:hover {
      box-shadow: 0 4px 15px rgba(218,165,32,0.4);
    }

    .name-prompt button:focus-visible {
      outline: 3px solid #fff;
      outline-offset: 3px;
    }

    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
    }

    .leaderboard-table th,
    .leaderboard-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .leaderboard-table th {
      color: rgba(255,255,255,0.7);
      font-weight: normal;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 1px;
    }

    .leaderboard-table .rank {
      width: 50px;
      color: #daa520;
      font-weight: bold;
    }

    .leaderboard-table .score-col {
      text-align: right;
      color: #daa520;
      font-weight: bold;
    }

    .leaderboard-table tr.highlight {
      background: rgba(218,165,32,0.15);
    }

    /* Event timeline */
    .timeline-section {
      margin-top: 40px;
      padding-top: 40px;
      border-top: 1px solid rgba(255,255,255,0.1);
      text-align: left;
    }

    .timeline-section h2 {
      font-size: 1.3rem;
      font-weight: normal;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-align: center;
      margin-bottom: 20px;
    }

    .timeline-list {
      list-style: none;
      padding: 0;
      position: relative;
      margin-left: 60px;
      border-left: 2px solid rgba(218,165,32,0.4);
    }

    .timeline-list li {
      padding: 8px 0 8px 20px;
      position: relative;
      font-size: 0.95rem;
      color: rgba(255,255,255,0.85);
    }

    .timeline-list li::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 14px;
      width: 10px;
      height: 10px;
      background: #daa520;
      border-radius: 50%;
    }

    .timeline-year {
      position: absolute;
      left: -60px;
      width: 40px;
      text-align: right;
      color: #daa520;
      font-weight: bold;
      font-size: 0.85rem;
    }

    /* Hide elements */
    .hidden {
      display: none !important;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      .choice-btn:hover,
      .next-btn:hover,
      .start-btn:hover,
      .play-again-btn:hover {
        transform: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Header -->
    <header class="header">
      <h1>Timeline Challenge</h1>
      <p class="subtitle">American History 1870â€“1928</p>
      <div class="decorative-line" aria-hidden="true">
        <span class="star-icon">&#9733;</span>
      </div>
    </header>

    <main>

    <!-- Score Bar -->
    <div class="score-bar" id="scoreBar" role="region" aria-label="Game Score">
      <div class="score-item">
        <div class="score-label" id="scoreLabelPoints">Score</div>
        <div class="score-value" id="currentScore" aria-labelledby="scoreLabelPoints">0</div>
      </div>
      <div class="score-item">
        <div class="score-label" id="scoreLabelStreak">Streak</div>
        <div class="score-value" id="currentStreak" aria-labelledby="scoreLabelStreak">0</div>
      </div>
      <div class="score-item">
        <div class="score-label" id="scoreLabelBest">Best Streak</div>
        <div class="score-value" id="bestStreak" aria-labelledby="scoreLabelBest">0</div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container" id="progressContainer">
      <div class="progress-label">
        <span>Progress</span>
        <span id="progressText" aria-live="polite">Question 1 of 10</span>
      </div>
      <div class="progress-bar" role="progressbar" id="progressBar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Question progress">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
    </div>

    <!-- Game Area -->
    <div class="game-area">

      <!-- Start Screen -->
      <div class="start-screen" id="startScreen" role="region" aria-label="Game Introduction">
        <h2>Test Your Knowledge of American History</h2>
        <p>
          You'll be shown a historical event with its year. Then you'll see another event
          and must decide: did it happen <strong>before</strong> or <strong>after</strong>
          the first event?
        </p>
        <p>
          Build your streak by answering correctly. The longer your streak, the higher your score!
        </p>
        <button class="start-btn" onclick="startGame()">Begin Challenge</button>
      </div>

      <!-- Game Screen -->
      <div id="gameScreen" class="hidden" role="region" aria-label="Current Question" tabindex="-1">

        <!-- Reference Event -->
        <div class="reference-event">
          <span class="reference-label">Reference Event</span>
          <div class="reference-year" id="refYear">1898</div>
          <div class="reference-title" id="refTitle">Spanish-American War</div>
          <div class="reference-description" id="refDescription">
            The United States declared war on Spain, resulting in American acquisition of Puerto Rico, Guam, and the Philippines.
          </div>
        </div>

        <!-- Question -->
        <div class="question-prompt">
          <p id="questionText">Did the event below happen before or after the reference event?</p>
          <div class="mystery-event" id="mysteryEvent" aria-labelledby="questionText">
            Construction of the Brooklyn Bridge completed
          </div>
        </div>

        <!-- Choice Buttons -->
        <div class="choices" role="group" aria-label="Choose your answer">
          <button class="choice-btn" id="beforeBtn" onclick="makeGuess('before')" aria-label="Before the reference event">
            <span class="arrow" aria-hidden="true">&larr;</span>
            <span class="label">Before</span>
          </button>
          <button class="choice-btn" id="afterBtn" onclick="makeGuess('after')" aria-label="After the reference event">
            <span class="arrow" aria-hidden="true">&rarr;</span>
            <span class="label">After</span>
          </button>
        </div>

        <!-- Result Display -->
        <div class="result-display" id="resultDisplay" role="status" aria-live="assertive">
          <div class="result-icon" id="resultIcon" aria-hidden="true">&#10003;</div>
          <div class="result-text" id="resultText">Correct!</div>
          <div class="result-explanation" id="resultExplanation"></div>
          <div class="result-context" id="resultContext"></div>
        </div>

        <!-- Next Button -->
        <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Next Question</button>

      </div>

      <!-- End Screen -->
      <div class="end-screen" id="endScreen" role="region" aria-label="Final Results" tabindex="-1">
        <h2>Challenge Complete!</h2>
        <div class="final-score">
          <span id="finalScoreValue">85</span><span>%</span>
        </div>
        <div class="grade-badge" id="gradeBadge">History Scholar</div>
        <p class="end-message" id="endMessage">
          Excellent work! You demonstrated strong knowledge of American history from the Gilded Age through the Jazz Age.
        </p>
        <button class="play-again-btn" onclick="resetGame()">Play Again</button>

        <!-- Event Timeline -->
        <div class="timeline-section" id="timelineSection">
          <h2>Your Events in Order</h2>
          <ul class="timeline-list" id="timelineList"></ul>
        </div>

        <!-- Name Prompt -->
        <div class="name-prompt" id="namePrompt">
          <label for="playerNameInput">Enter your name for the Honor Roll:</label>
          <div>
            <input type="text" id="playerNameInput" maxlength="30" placeholder="Your name">
            <button onclick="submitName()">Submit</button>
          </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard-section hidden" id="leaderboardSection">
          <div class="leaderboard-header">
            <h2>&#9733; Honor Roll &#9733;</h2>
          </div>
          <table class="leaderboard-table" aria-label="Leaderboard scores">
            <thead>
              <tr>
                <th scope="col">Rank</th>
                <th scope="col">Student</th>
                <th scope="col">Score</th>
              </tr>
            </thead>
            <tbody id="leaderboardBody">
              <tr>
                <td class="rank">#1</td>
                <td>Loading...</td>
                <td class="score-col">--</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>

    </main>

  </div>

  <script>
    // ============================================
    // HISTORICAL EVENTS DATABASE
    // ============================================
    const EVENTS = [
      {
        year: 1870,
        title: "15th Amendment Ratified",
        description: "Prohibited denying the right to vote based on race, color, or previous condition of servitude.",
        context: "The Fifteenth Amendment was a landmark achievement of the Reconstruction era, designed to protect the voting rights of formerly enslaved men. However, its promise was quickly undermined in the South through poll taxes, literacy tests, and outright violence. It would take nearly a century\u2014and the Voting Rights Act of 1965\u2014before the amendment's protections were fully enforced."
      },
      {
        year: 1871,
        title: "Great Chicago Fire",
        description: "A devastating fire burned for three days, destroying much of the city and leaving 100,000 homeless.",
        context: "The Great Chicago Fire destroyed roughly 3.3 square miles of the city, including its central business district. The disaster became a turning point for urban planning and fire safety in American cities. Chicago rebuilt rapidly using new fireproof construction techniques and grew into one of the nation's largest and most modern cities by the end of the century."
      },
      {
        year: 1876,
        title: "Battle of Little Bighorn",
        description: "Lakota, Northern Cheyenne, and Arapaho forces defeated the 7th Cavalry Regiment led by George Custer.",
        context: "The Battle of Little Bighorn was the most significant Native American victory in the Indian Wars. Sitting Bull and Crazy Horse led a coalition of Lakota, Northern Cheyenne, and Arapaho warriors who overwhelmed Custer's forces. The stunning defeat shocked the nation and intensified the U.S. government's campaign to force Native peoples onto reservations."
      },
      {
        year: 1876,
        title: "Alexander Graham Bell Patents the Telephone",
        description: "Bell received the first patent for the telephone, revolutionizing communication.",
        context: "Bell's telephone patent marked a turning point in the era of inventions that reshaped American life during industrialization. These inventors generated ideas and gadgets that transformed the economy and fueled the country's industrial growth. By 1900, over one million telephones were in operation, connecting businesses and families across the country."
      },
      {
        year: 1877,
        title: "End of Reconstruction",
        description: "Federal troops withdrew from the South following the Compromise of 1877, ending the Reconstruction era.",
        context: "The Compromise of 1877 resolved the disputed presidential election between Rutherford B. Hayes and Samuel Tilden by awarding Hayes the presidency in exchange for withdrawing federal troops from the South. This effectively ended Reconstruction and opened the door for Southern Democrats, known as 'Redeemers,' to roll back the political and social gains African Americans had achieved since the Civil War."
      },
      {
        year: 1877,
        title: "Great Railroad Strike",
        description: "Railroad workers struck from Baltimore to St. Louis after rail lines slashed wages, shutting down the nation's economic lifeblood.",
        context: "The Great Railroad Strike of 1877 was the first major nationwide labor action in American history. After railroad companies slashed wages for the second time in a year, workers in city after city walked off the job, and the strike quickly spread across the country. Federal troops were called in to crush the strike, and nearly 100 Americans died in the violence. The event convinced many laborers of the need for organized, institutionalized labor unions."
      },
      {
        year: 1879,
        title: "Thomas Edison Demonstrates the Light Bulb",
        description: "Edison publicly demonstrated his incandescent light bulb at Menlo Park, New Jersey.",
        context: "Edison's light bulb was just one of over a thousand patents he held, earning him the nickname 'the Wizard of Menlo Park.' His invention of a practical incandescent bulb\u2014and the electrical generation and distribution system to support it\u2014transformed American cities. Electric lighting extended the workday, enabled nightlife, and fundamentally changed how Americans lived and worked."
      },
      {
        year: 1881,
        title: "President Garfield Assassinated",
        description: "James A. Garfield was shot by Charles Guiteau and died 11 weeks later from his wounds.",
        context: "Charles Guiteau, a disappointed office seeker, shot President Garfield at a Washington railroad station. Garfield lingered for eleven weeks before dying of his wounds. The assassination shocked the nation and exposed the corruption of the spoils system, directly leading to the passage of the Pendleton Civil Service Reform Act of 1883, which established a merit-based system for federal employment."
      },
      {
        year: 1882,
        title: "Chinese Exclusion Act",
        description: "Congress passed the first significant law restricting immigration, barring Chinese laborers.",
        context: "The Chinese Exclusion Act was the first federal law to restrict immigration based on race and nationality. Anti-Chinese sentiment had been building for years, particularly in the West, where Chinese laborers were blamed for depressing wages. The act barred Chinese laborers from entering the country and denied citizenship to those already here. It was not repealed until 1943 and set a precedent for future restrictive immigration policies."
      },
      {
        year: 1883,
        title: "Brooklyn Bridge Opens",
        description: "After 14 years of construction, the Brooklyn Bridge opened as the longest suspension bridge in the world.",
        context: "The Brooklyn Bridge was an engineering marvel that symbolized the explosive growth of American cities during the Gilded Age. As urban populations boomed, new technologies like suspension bridges, steel-frame skyscrapers, and electric streetcars reshaped the landscape. The bridge connected Brooklyn and Manhattan, facilitating the movement of workers and goods that fueled New York's rise as a global city."
      },
      {
        year: 1886,
        title: "Statue of Liberty Dedicated",
        description: "France's gift to America was dedicated in New York Harbor by President Grover Cleveland.",
        context: "The Statue of Liberty arrived from France as a symbol of republican ideals and the friendship between the two nations. Its location in New York Harbor gave it a powerful association with immigration, as millions of newcomers arriving by ship saw it as their first glimpse of America. Emma Lazarus's famous poem on its pedestal\u2014'Give me your tired, your poor'\u2014cemented this connection in the American imagination."
      },
      {
        year: 1886,
        title: "Haymarket Affair",
        description: "A bombing at a labor rally in Chicago led to a trial that became a cause for the labor movement.",
        context: "At a labor rally in Chicago's Haymarket Square, someone threw a bomb at police, killing seven officers. Police opened fire, and several civilians died as well. Eight anarchists were tried and convicted despite thin evidence, and four were executed. The Haymarket Affair discredited the Knights of Labor and radical labor movements in the public eye, but it also galvanized the fight for workers' rights and is commemorated internationally as the origin of May Day."
      },
      {
        year: 1887,
        title: "Dawes General Allotment Act",
        description: "Congress divided Native American reservations into individual family homesteads, with 'surplus' tribal lands sold to White settlers.",
        context: "The Dawes Act was presented as humanitarian reform, but it devastated Native American communities. The law broke up communal tribal lands into 160-acre individual allotments, with remaining 'surplus' land sold to White settlers. As a result, Native peoples lost as much as eighty million acres of land. The act undermined tribal sovereignty and traditional ways of life, and its effects were not reversed until the Indian Reorganization Act of 1934."
      },
      {
        year: 1889,
        title: "Oklahoma Land Rush",
        description: "Nearly 50,000 settlers raced to claim land in the Unassigned Lands of Indian Territory.",
        context: "The Oklahoma Land Rush of 1889 was one of the most dramatic episodes of westward expansion. At the sound of a starting gun, thousands of settlers on horseback and in wagons raced to stake claims on nearly two million acres of land that had been designated Indian Territory. Those who sneaked in early to claim the best land were called 'Sooners.' The event reflected the federal government's ongoing policy of opening Native lands to White settlement."
      },
      {
        year: 1890,
        title: "Wounded Knee Massacre",
        description: "U.S. Army soldiers killed hundreds of Lakota people at Wounded Knee Creek in South Dakota.",
        context: "The Massacre at Wounded Knee was the last major confrontation of the Indian Wars. U.S. soldiers attempted to disarm a group of Lakota near Wounded Knee Creek, and when a gun discharged, soldiers opened fire indiscriminately. As many as 300 Lakota men, women, and children were killed. The tragedy marked the definitive end of armed Native American resistance on the Great Plains and remains a powerful symbol of the violence of westward expansion."
      },
      {
        year: 1890,
        title: "Sherman Anti-Trust Act Passed",
        description: "Congress empowered federal prosecutors to ban monopolies as conspiracies against interstate trade.",
        context: "The Sherman Anti-Trust Act was Congress's first attempt to rein in the powerful trusts and monopolies that dominated the Gilded Age economy. Companies like Standard Oil used horizontal and vertical integration to control entire industries and crush competition. However, a conservative Supreme Court limited the act's enforcement for years. It was not until the Progressive Era that presidents like Theodore Roosevelt used it aggressively to break up trusts like Standard Oil and Northern Securities."
      },
      {
        year: 1892,
        title: "Ellis Island Opens",
        description: "The federal immigration station opened, processing over 12 million immigrants over the next 62 years.",
        context: "Ellis Island became the gateway for millions of immigrants seeking a new life in America. Most arrivals were from Southern and Eastern Europe\u2014Italians, Poles, Russians, and others\u2014fleeing poverty, religious persecution, or political instability. Immigrants underwent medical and legal inspections, and while most were admitted within hours, the experience could be frightening and dehumanizing. These new arrivals fueled the growth of American cities and industry."
      },
      {
        year: 1892,
        title: "Homestead Steel Strike",
        description: "A contract dispute at Carnegie Steel led manager Henry Frick to lock out workers and hire Pinkerton detectives, resulting in a deadly battle.",
        context: "The Homestead Strike was one of the most violent labor conflicts in American history. When negotiations broke down at Carnegie Steel's Homestead plant near Pittsburgh, manager Henry Clay Frick locked out workers and hired 300 Pinkerton detectives to protect strikebreakers. A gunfight erupted that killed three Pinkertons and six workers. The Pennsylvania militia ultimately broke the strike, and its failure crushed the steelworkers' union for decades."
      },
      {
        year: 1893,
        title: "World's Columbian Exposition",
        description: "Chicago hosted the World's Fair celebrating the 400th anniversary of Columbus's arrival.",
        context: "The 1893 World's Fair in Chicago showcased American technological achievement and cultural ambition to the world. The gleaming 'White City' featured electric lights, new inventions, and grand architecture. The fair also coincided with historian Frederick Jackson Turner's influential 'frontier thesis,' which argued that the closing of the western frontier marked the end of a defining chapter in American identity."
      },
      {
        year: 1894,
        title: "Pullman Strike",
        description: "After George Pullman slashed wages, Eugene V. Debs and the American Railway Union led a boycott that shut down the nation's railroad system.",
        context: "The Pullman Strike began when the Pullman Palace Car Company cut wages by 25 percent without reducing rents in its company town. Eugene V. Debs and the American Railway Union organized a nationwide boycott that virtually paralyzed rail traffic across the country. President Cleveland sent federal troops to break the strike under the pretense of protecting U.S. mail delivery. Debs was arrested and imprisoned, and the episode radicalized him toward socialism."
      },
      {
        year: 1896,
        title: "Plessy v. Ferguson",
        description: "Supreme Court upheld 'separate but equal' doctrine, legalizing racial segregation.",
        context: "In Plessy v. Ferguson, the Supreme Court ruled that racial segregation was constitutional as long as facilities were 'separate but equal.' In practice, facilities for Black Americans were never equal. The decision provided legal justification for Jim Crow laws across the South, entrenching a system of racial apartheid that would persist for nearly sixty years until the Court reversed course in Brown v. Board of Education (1954)."
      },
      {
        year: 1898,
        title: "Spanish-American War",
        description: "The U.S. declared war on Spain, gaining Puerto Rico, Guam, and the Philippines.",
        context: "The Spanish-American War marked America's emergence as a global imperial power. Fueled by yellow journalism and outrage over Spain's treatment of Cuban rebels, the United States quickly defeated Spain in what Secretary of State John Hay called 'a splendid little war.' The Treaty of Paris gave the U.S. control of Puerto Rico, Guam, and the Philippines, sparking a fierce national debate over whether a republic founded on liberty should govern colonial subjects."
      },
      {
        year: 1898,
        title: "USS Maine Explosion",
        description: "The battleship Maine exploded in Havana Harbor, helping spark the Spanish-American War.",
        context: "The mysterious explosion of the USS Maine in Havana Harbor killed 260 American sailors and became a rallying cry for war. 'Remember the Maine!' screamed the headlines of William Randolph Hearst's and Joseph Pulitzer's newspapers, which practiced 'yellow journalism' that sensationalized events to boost sales. Although the cause of the explosion was never definitively determined, it gave interventionists the justification they needed to push for war with Spain."
      },
      {
        year: 1898,
        title: "Wilmington Massacre",
        description: "White supremacists overthrew the elected biracial government of Wilmington, North Carolina, killing dozens of Black citizens.",
        context: "The Wilmington Massacre was one of the most brazen acts of racial violence in the post-Reconstruction South. White supremacist 'Red Shirts' destroyed the Black-owned Daily Record newspaper and murdered an estimated 60 to 300 Black citizens. They then overthrew the legitimately elected biracial city government in what was effectively a coup d'etat. Over 2,000 Black residents were forced to permanently flee, transforming the formerly Black-majority city."
      },
      {
        year: 1899,
        title: "Open Door Notes on China",
        description: "Secretary of State John Hay demanded that all nations have equal access to Chinese markets.",
        context: "The Open Door notes reflected America's growing ambitions in Asia. As European powers carved China into spheres of influence, Secretary of State John Hay issued diplomatic circulars insisting on equal commercial access for all nations. While framed as a principled stand for free trade, the policy greatly favored the United States, whose efficient industries could flood Chinese markets with American goods. The policy shaped U.S.-China relations for decades."
      },
      {
        year: 1901,
        title: "President McKinley Assassinated",
        description: "William McKinley was shot by anarchist Leon Czolgosz and died eight days later.",
        context: "President McKinley was shot while greeting the public at the Pan-American Exposition in Buffalo, New York. His assassin, Leon Czolgosz, was an anarchist who believed he was striking a blow against an unjust government. McKinley's death made Theodore Roosevelt\u2014at 42\u2014the youngest president in American history, ushering in a dramatic new era of Progressive politics and an expanded role for the federal government."
      },
      {
        year: 1901,
        title: "Theodore Roosevelt Becomes President",
        description: "After McKinley's assassination, Roosevelt became the youngest president in the nation's history.",
        context: "Roosevelt's unexpected ascension to the presidency transformed American politics. He embraced what he called the 'Square Deal,' using the power of the federal government to regulate big business, protect consumers, and conserve natural resources. His trust-busting campaigns against monopolies like Northern Securities, his mediation of labor disputes, and his establishment of national parks redefined the role of the presidency for the twentieth century."
      },
      {
        year: 1903,
        title: "Wright Brothers' First Flight",
        description: "Orville and Wilbur Wright achieved the first powered airplane flight at Kitty Hawk, North Carolina.",
        context: "The Wright Brothers' twelve-second flight at Kitty Hawk launched the age of aviation. Working as bicycle mechanics from Dayton, Ohio, Orville and Wilbur Wright solved the problems of powered flight through meticulous experimentation. Their achievement exemplified the era's spirit of invention and technological optimism. Within just over a decade, airplanes would be used as weapons of war in World War I."
      },
      {
        year: 1906,
        title: "San Francisco Earthquake",
        description: "A massive earthquake and subsequent fires destroyed much of San Francisco, killing over 3,000 people.",
        context: "The 1906 San Francisco earthquake and the fires that followed devastated one of America's most important cities. Over half the city's population of 400,000 was left homeless. The disaster exposed the vulnerability of rapidly growing urban centers and prompted major reforms in building codes and urban planning. San Francisco's rapid rebuilding became a symbol of American resilience and determination."
      },
      {
        year: 1906,
        title: "Pure Food and Drug Act",
        description: "Spurred by Upton Sinclair's novel The Jungle, Congress passed laws requiring food and drug labeling and meat inspection.",
        context: "The Pure Food and Drug Act was a signature achievement of Progressive Era reform. Public outrage over Upton Sinclair's novel The Jungle, which exposed the horrifying conditions of the meatpacking industry, gave Roosevelt the political leverage to push the legislation through Congress. The act required accurate labeling of food and drug products and established government inspection of meat, laying the groundwork for modern consumer protection."
      },
      {
        year: 1908,
        title: "Ford Model T Introduced",
        description: "Henry Ford introduced the affordable Model T, revolutionizing American transportation.",
        context: "Henry Ford's Model T put the automobile within reach of ordinary Americans for the first time. By pioneering assembly-line production at his Highland Park plant, Ford dramatically reduced costs\u2014the price dropped from $850 in 1908 to under $300 by the 1920s. The automobile reshaped American life, enabling suburban growth, transforming courtship and leisure, and creating vast new industries in steel, rubber, glass, and petroleum."
      },
      {
        year: 1909,
        title: "NAACP Founded",
        description: "The National Association for the Advancement of Colored People was established in New York City.",
        context: "The NAACP grew out of the Niagara Movement, led by W. E. B. Du Bois, which called for immediate political, economic, and social equality for African Americans. Du Bois rejected Booker T. Washington's strategy of accommodation, arguing instead that the 'talented tenth' of educated Black leaders should fight directly for civil rights through legal and political channels. The NAACP became the nation's most influential civil rights organization, using litigation and advocacy to challenge racial injustice."
      },
      {
        year: 1911,
        title: "Triangle Shirtwaist Factory Fire",
        description: "A fire in a New York garment factory killed 146 workers, spurring labor safety reforms.",
        context: "The Triangle Shirtwaist Factory fire was one of the deadliest industrial disasters in American history. Workers\u2014mostly young immigrant women\u2014were trapped on the upper floors because managers had locked the exit doors to prevent unauthorized breaks. Many jumped to their deaths from the ninth floor. The tragedy galvanized the labor movement and led directly to dozens of new laws improving workplace safety, fire codes, and labor conditions."
      },
      {
        year: 1912,
        title: "Titanic Sinks",
        description: "The RMS Titanic struck an iceberg and sank on its maiden voyage, killing over 1,500 people.",
        context: "The sinking of the Titanic shattered the era's faith in technological progress and human mastery over nature. The 'unsinkable' ship's destruction on its maiden voyage revealed the dangers of hubris and inadequate safety regulations. The disaster led to major reforms in maritime safety, including requirements for sufficient lifeboats and the establishment of the International Ice Patrol."
      },
      {
        year: 1913,
        title: "Federal Reserve Created",
        description: "Congress established the Federal Reserve System to provide the nation with a stable monetary system.",
        context: "The Federal Reserve Act was a centerpiece of Woodrow Wilson's 'New Freedom' agenda. The new system created twelve regional Federal Reserve banks overseen by a federal board, giving the government greater control over the money supply and banking system. It was designed to prevent the financial panics that had repeatedly destabilized the economy, including the devastating Panic of 1893 and the Panic of 1907."
      },
      {
        year: 1914,
        title: "Panama Canal Opens",
        description: "The canal connecting the Atlantic and Pacific oceans opened after a decade of American construction.",
        context: "The Panama Canal was Theodore Roosevelt's most ambitious foreign policy achievement. After supporting Panamanian independence from Colombia, the U.S. secured the right to build and control the canal zone. The massive engineering project, completed under brutal tropical conditions, cut the shipping route between the Atlantic and Pacific by thousands of miles and cemented American strategic dominance in the Western Hemisphere."
      },
      {
        year: 1917,
        title: "United States Enters World War I",
        description: "Following German submarine attacks and the Zimmermann Telegram, the U.S. declared war and joined the Allied Powers.",
        context: "Despite campaigning on the slogan 'He kept us out of war,' President Wilson asked Congress for a declaration of war in April 1917. Germany's unrestricted submarine warfare, which sank American merchant ships, and the Zimmermann Telegram\u2014in which Germany offered to help Mexico reclaim territory lost to the United States\u2014made neutrality untenable. Fifty-six members of Congress voted against the war resolution, the largest 'no' vote against a war resolution in American history."
      },
      {
        year: 1918,
        title: "Spanish Flu Pandemic Begins",
        description: "The devastating influenza pandemic infected 500 million people worldwide, killing up to 50 million.",
        context: "The influenza pandemic of 1918 was one of the deadliest events in human history. Returning troops brought the virus home, and within months over twenty million Americans fell ill. Eventually 675,000 Americans died. Americans avoided public gatherings, children wore surgical masks to school, and undertakers ran out of coffins. The pandemic compounded the trauma of the war and contributed to a pervasive sense of disillusionment."
      },
      {
        year: 1919,
        title: "18th Amendment Ratified (Prohibition)",
        description: "The Constitution was amended to ban the manufacture, sale, and transportation of alcohol.",
        context: "Prohibition was the culmination of decades of temperance activism, particularly by women's groups like the Woman's Christian Temperance Union. Reformers blamed alcohol for poverty, domestic violence, and political corruption. However, the ban proved nearly impossible to enforce and gave rise to organized crime, speakeasies, and bootlegging. Prohibition was repealed by the 21st Amendment in 1933\u2014the only constitutional amendment ever to be fully repealed."
      },
      {
        year: 1919,
        title: "Red Summer Race Riots",
        description: "Violent race riots erupted across America, including a major riot in Chicago triggered by the murder of a Black teenager.",
        context: "The summer of 1919 saw race riots erupt in cities across the nation. In Chicago, a White mob stoned a young Black boy to death for swimming near the 'White beach' on Lake Michigan. The week-long riot that followed left 38 people dead and millions of dollars in damage. White soldiers returning from war sought to reassert racial dominance, while Black veterans returned determined to fight for their rights. The violence demonstrated that racial discrimination was a national\u2014not solely southern\u2014problem."
      },
      {
        year: 1920,
        title: "19th Amendment Ratified",
        description: "Women gained the right to vote after decades of suffrage activism.",
        context: "The Nineteenth Amendment was the culmination of over seventy years of activism, from the Seneca Falls Convention of 1848 through the militant protests of Alice Paul and the National Woman's Party. Women's contributions during World War I strengthened the case for suffrage. The amendment's passage expanded the electorate dramatically, though many women of color continued to face barriers to voting, particularly in the South."
      },
      {
        year: 1920,
        title: "First Commercial Radio Broadcast",
        description: "KDKA in Pittsburgh broadcast the first commercial radio program, reporting election results.",
        context: "Radio quickly became one of the most transformative technologies of the 1920s. Hundreds of stations sprang up across the country, broadcasting news, music, serial dramas, and advertising into American homes. Radio had the effect of smoothing out regional differences in dialect, language, music, and even consumer taste, creating a shared national culture. Syndicated programs like Amos 'n' Andy entertained millions, though often through harmful racial stereotypes."
      },
      {
        year: 1921,
        title: "Tulsa Race Massacre",
        description: "A White mob attacked and destroyed the prosperous Black neighborhood of Greenwood, killing hundreds.",
        context: "The Tulsa Race Massacre was the deadliest race massacre in American history. Greenwood, known as 'Black Wall Street,' was a thriving African American community. Spurred by a false accusation against a young Black man, a White mob destroyed over thirty square blocks, burning more than 1,000 homes. Survivors reported machine guns and planes dropping firebombs. Victims were buried in mass graves, and thousands of survivors were left homeless."
      },
      {
        year: 1923,
        title: "Teapot Dome Scandal",
        description: "A bribery scandal in which the Secretary of the Interior secretly leased federal oil reserves to private companies.",
        context: "The Teapot Dome Scandal was the most significant government corruption case of the early twentieth century. Secretary of the Interior Albert Fall secretly leased naval oil reserves at Teapot Dome, Wyoming, and Elk Hills, California, to private oil companies in exchange for cash and no-interest loans. When a Senate investigation exposed the scheme, Fall became the first former Cabinet member in American history to be sent to prison. The scandal tarnished the legacy of President Warren G. Harding and fueled public cynicism about government corruption during the Roaring Twenties."
      },
      {
        year: 1925,
        title: "Scopes Trial",
        description: "Tennessee teacher John Scopes was tried for teaching evolution, drawing national attention.",
        context: "The Scopes 'Monkey Trial' became a national spectacle that highlighted the growing divide between urban modernism and rural traditionalism. Tennessee's Butler Act made it illegal to teach evolution in public schools. The ACLU recruited Scopes to challenge the law, with legendary attorney Clarence Darrow defending him against prosecutor William Jennings Bryan. Though Scopes was convicted and fined $100, the trial exposed fundamentalism to national ridicule and marked a key moment in America's enduring 'culture war.'"
      },
      {
        year: 1927,
        title: "Lindbergh Crosses the Atlantic",
        description: "Charles Lindbergh completed the first solo nonstop transatlantic flight in the Spirit of St. Louis.",
        context: "Lindbergh's 33.5-hour solo flight from New York to Paris electrified the world and made him an instant international celebrity. The achievement symbolized the technological optimism and daring individualism of the Jazz Age. Aviation had advanced rapidly since the Wright Brothers' first flight just 24 years earlier, and Lindbergh's feat helped launch the commercial aviation industry."
      },
      {
        year: 1928,
        title: "First Mickey Mouse Cartoon",
        description: "Walt Disney's Steamboat Willie premiered, introducing Mickey Mouse to audiences.",
        context: "Steamboat Willie was one of the first cartoons to feature synchronized sound throughout, and it made Mickey Mouse a cultural phenomenon. The film reflected the explosive growth of the entertainment industry in the 1920s, when movies, radio, and popular music created a shared national culture. By the end of the decade, weekly movie attendance had swelled to ninety million people, and Hollywood had become one of America's most profitable industries."
      }
    ];

    // ============================================
    // GAME STATE
    // ============================================
    let gameState = {
      currentQuestion: 0,
      totalQuestions: 10,
      score: 0,
      correct: 0,
      streak: 0,
      bestStreak: 0,
      referenceEvent: null,
      mysteryEvent: null,
      usedEvents: [],
      seenEvents: [],
      playerName: null
    };

    // Leaderboard data â€” load from localStorage or seed with defaults
    var DEFAULT_LEADERBOARD = [
      { name: "Thomas J.", score: 95 },
      { name: "Eleanor R.", score: 90 },
      { name: "Theodore", score: 85 },
      { name: "Woodrow W.", score: 80 },
      { name: "Calvin C.", score: 75 }
    ];

    let leaderboardData = (function() {
      try {
        var saved = localStorage.getItem('timelineLeaderboard');
        if (saved) { return JSON.parse(saved); }
      } catch (e) { /* localStorage unavailable */ }
      return DEFAULT_LEADERBOARD.map(function(e) { return { name: e.name, score: e.score }; });
    })();

    // ============================================
    // GAME FUNCTIONS
    // ============================================

    function startGame() {
      // Reset state
      gameState.currentQuestion = 0;
      gameState.score = 0;
      gameState.correct = 0;
      gameState.streak = 0;
      gameState.bestStreak = 0;
      gameState.usedEvents = [];
      gameState.seenEvents = [];

      // Update UI
      updateScoreDisplay();
      updateProgress();

      // Show game screen
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('endScreen').classList.remove('show');
      document.getElementById('gameScreen').classList.remove('hidden');
      document.getElementById('scoreBar').classList.remove('hidden');
      document.getElementById('progressContainer').classList.remove('hidden');

      // Load first question
      loadQuestion();

      // Move focus to game screen for screen readers
      document.getElementById('gameScreen').focus();

      // Tell SCORM we've started
      SCORM.setStatus('incomplete');
    }

    function loadQuestion() {
      // Reset UI state
      document.getElementById('resultDisplay').classList.remove('show', 'correct', 'incorrect');
      document.getElementById('nextBtn').classList.remove('show');
      document.getElementById('beforeBtn').disabled = false;
      document.getElementById('afterBtn').disabled = false;
      document.getElementById('beforeBtn').classList.remove('correct', 'incorrect');
      document.getElementById('afterBtn').classList.remove('correct', 'incorrect');

      // Pick two different events we haven't used
      let availableEvents = EVENTS.filter((_, i) => !gameState.usedEvents.includes(i));

      if (availableEvents.length < 2) {
        // Reset if we've used too many
        gameState.usedEvents = [];
        availableEvents = [...EVENTS];
      }

      // Randomly select reference event
      const refIndex = Math.floor(Math.random() * availableEvents.length);
      gameState.referenceEvent = availableEvents[refIndex];
      const refOriginalIndex = EVENTS.indexOf(gameState.referenceEvent);
      gameState.usedEvents.push(refOriginalIndex);

      // Remove reference from available for mystery selection
      availableEvents.splice(refIndex, 1);

      // Select mystery event (must be different year for clear answer)
      let mysteryOptions = availableEvents.filter(e => e.year !== gameState.referenceEvent.year);
      if (mysteryOptions.length === 0) mysteryOptions = availableEvents;

      const mystIndex = Math.floor(Math.random() * mysteryOptions.length);
      gameState.mysteryEvent = mysteryOptions[mystIndex];
      const mystOriginalIndex = EVENTS.indexOf(gameState.mysteryEvent);
      gameState.usedEvents.push(mystOriginalIndex);

      // Track seen events for end-of-game timeline
      gameState.seenEvents.push({ year: gameState.referenceEvent.year, title: gameState.referenceEvent.title });
      gameState.seenEvents.push({ year: gameState.mysteryEvent.year, title: gameState.mysteryEvent.title });

      // Update display
      document.getElementById('refYear').textContent = gameState.referenceEvent.year;
      document.getElementById('refTitle').textContent = gameState.referenceEvent.title;
      document.getElementById('refDescription').textContent = gameState.referenceEvent.description;
      document.getElementById('mysteryEvent').textContent = gameState.mysteryEvent.title;

      // Update button aria-labels with actual event names
      document.getElementById('beforeBtn').setAttribute('aria-label',
        gameState.mysteryEvent.title + ' happened before ' + gameState.referenceEvent.title);
      document.getElementById('afterBtn').setAttribute('aria-label',
        gameState.mysteryEvent.title + ' happened after ' + gameState.referenceEvent.title);

      updateProgress();
    }

    function makeGuess(guess) {
      const correctAnswer = gameState.mysteryEvent.year < gameState.referenceEvent.year ? 'before' : 'after';
      const isCorrect = guess === correctAnswer;

      // Disable buttons
      document.getElementById('beforeBtn').disabled = true;
      document.getElementById('afterBtn').disabled = true;

      // Highlight buttons
      if (guess === 'before') {
        document.getElementById('beforeBtn').classList.add(isCorrect ? 'correct' : 'incorrect');
        if (!isCorrect) document.getElementById('afterBtn').classList.add('correct');
      } else {
        document.getElementById('afterBtn').classList.add(isCorrect ? 'correct' : 'incorrect');
        if (!isCorrect) document.getElementById('beforeBtn').classList.add('correct');
      }

      // Update score and streak
      if (isCorrect) {
        gameState.correct++;
        gameState.streak++;
        if (gameState.streak > gameState.bestStreak) {
          gameState.bestStreak = gameState.streak;
        }
        // Bonus points for streaks
        gameState.score += 10 + (gameState.streak - 1) * 2;
      } else {
        gameState.streak = 0;
      }

      updateScoreDisplay();

      // Show result
      const resultDisplay = document.getElementById('resultDisplay');
      resultDisplay.classList.add('show', isCorrect ? 'correct' : 'incorrect');
      document.getElementById('resultIcon').textContent = isCorrect ? '\u2713' : '\u2717';
      document.getElementById('resultText').textContent = isCorrect ? 'Correct!' : 'Not quite...';

      const yearDiff = Math.abs(gameState.mysteryEvent.year - gameState.referenceEvent.year);
      const beforeAfter = gameState.mysteryEvent.year < gameState.referenceEvent.year ? 'before' : 'after';
      document.getElementById('resultExplanation').innerHTML =
        '<strong>' + gameState.mysteryEvent.title + '</strong> occurred in ' +
        '<span class="result-year">' + gameState.mysteryEvent.year + '</span>, ' +
        yearDiff + ' year' + (yearDiff !== 1 ? 's' : '') + ' ' + beforeAfter + ' ' + gameState.referenceEvent.title + '.';

      // Show educational context
      document.getElementById('resultContext').textContent = gameState.mysteryEvent.context;

      // Show next button and move focus to it
      var nextBtn = document.getElementById('nextBtn');
      nextBtn.classList.add('show');
      nextBtn.focus();

      gameState.currentQuestion++;
    }

    function nextQuestion() {
      if (gameState.currentQuestion >= gameState.totalQuestions) {
        endGame();
      } else {
        loadQuestion();
        // Move focus to the first choice button
        document.getElementById('beforeBtn').focus();
      }
    }

    function endGame() {
      const percentage = Math.round((gameState.correct / gameState.totalQuestions) * 100);

      // Determine grade
      let grade, message;
      if (percentage >= 90) {
        grade = "History Scholar";
        message = "Outstanding! You have an exceptional knowledge of American history from this transformative era.";
      } else if (percentage >= 80) {
        grade = "History Expert";
        message = "Excellent work! You demonstrated strong knowledge of American history from the Gilded Age through the Jazz Age.";
      } else if (percentage >= 70) {
        grade = "History Student";
        message = "Good job! You have a solid foundation in American history. Keep studying to improve your timeline knowledge.";
      } else if (percentage >= 60) {
        grade = "History Apprentice";
        message = "You're learning! Review the major events of this period to strengthen your understanding.";
      } else {
        grade = "History Beginner";
        message = "This era had many important events. Consider reviewing the material and try again!";
      }

      // Update end screen
      document.getElementById('finalScoreValue').textContent = percentage;
      document.getElementById('gradeBadge').textContent = grade;
      document.getElementById('endMessage').textContent = message;

      // Render timeline of seen events
      var unique = [];
      var seen = {};
      gameState.seenEvents.forEach(function(e) {
        var key = e.year + '|' + e.title;
        if (!seen[key]) { seen[key] = true; unique.push(e); }
      });
      unique.sort(function(a, b) { return a.year - b.year; });
      document.getElementById('timelineList').innerHTML = unique.map(function(e) {
        return '<li><span class="timeline-year">' + e.year + '</span>' + e.title + '</li>';
      }).join('');

      // Show end screen
      document.getElementById('gameScreen').classList.add('hidden');
      document.getElementById('endScreen').classList.add('show');

      // Move focus to end screen
      document.getElementById('endScreen').focus();

      // Report to SCORM
      SCORM.setScore(percentage);
      SCORM.complete(percentage);

      // Store percentage for name submission
      gameState.percentage = percentage;

      // Show name prompt, hide leaderboard until submitted
      document.getElementById('namePrompt').classList.remove('hidden');
      document.getElementById('leaderboardSection').classList.add('hidden');

      // Pre-fill with SCORM name if available
      var scormName = SCORM.getLearnerName();
      if (scormName && scormName !== 'Learner') {
        document.getElementById('playerNameInput').value = scormName;
      }

      // Focus the name input
      document.getElementById('playerNameInput').focus();
    }

    function submitName() {
      var input = document.getElementById('playerNameInput');
      var name = input.value.trim();
      if (!name) {
        input.focus();
        return;
      }
      gameState.playerName = name;
      addToLeaderboard(name, gameState.percentage);

      // Hide prompt, show leaderboard
      document.getElementById('namePrompt').classList.add('hidden');
      document.getElementById('leaderboardSection').classList.remove('hidden');
      loadLeaderboard();
    }

    function resetGame() {
      document.getElementById('endScreen').classList.remove('show');
      document.getElementById('startScreen').classList.remove('hidden');
      // Reset name prompt for next play
      document.getElementById('playerNameInput').value = '';
      document.getElementById('namePrompt').classList.remove('hidden');
      document.getElementById('leaderboardSection').classList.add('hidden');
      // Focus the start button
      document.querySelector('.start-btn').focus();
    }

    function updateScoreDisplay() {
      document.getElementById('currentScore').textContent = gameState.score;
      document.getElementById('currentStreak').textContent = gameState.streak;
      document.getElementById('bestStreak').textContent = gameState.bestStreak;
    }

    function updateProgress() {
      const questionNum = Math.min(gameState.currentQuestion + 1, gameState.totalQuestions);
      const pct = Math.round((gameState.currentQuestion / gameState.totalQuestions) * 100);
      document.getElementById('progressText').textContent =
        'Question ' + questionNum + ' of ' + gameState.totalQuestions;
      document.getElementById('progressFill').style.width = pct + '%';
      document.getElementById('progressBar').setAttribute('aria-valuenow', pct);
    }

    // ============================================
    // LEADERBOARD FUNCTIONS
    // ============================================

    function loadLeaderboard() {
      const tbody = document.getElementById('leaderboardBody');

      // Sort by score
      const sorted = [...leaderboardData].sort((a, b) => b.score - a.score);

      tbody.innerHTML = sorted.map(function(entry, i) {
        const isPlayer = entry.name === gameState.playerName;
        return '<tr class="' + (isPlayer ? 'highlight' : '') + '">' +
          '<td class="rank">#' + (i + 1) + '</td>' +
          '<td>' + entry.name + (isPlayer ? ' (You)' : '') + '</td>' +
          '<td class="score-col">' + entry.score + '%</td>' +
          '</tr>';
      }).join('');
    }

    function saveLeaderboard() {
      try {
        localStorage.setItem('timelineLeaderboard', JSON.stringify(leaderboardData));
      } catch (e) { /* localStorage unavailable */ }
    }

    function addToLeaderboard(name, score) {
      leaderboardData.push({ name: name, score: score });
      saveLeaderboard();
    }

    // ============================================
    // INITIALIZATION
    // ============================================

    window.addEventListener('load', function() {
      document.getElementById('gameScreen').classList.add('hidden');
      document.getElementById('scoreBar').classList.add('hidden');
      document.getElementById('progressContainer').classList.add('hidden');

      // Submit name on Enter key
      document.getElementById('playerNameInput').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') { submitName(); }
      });
    });
  </script>
</body>
</html>
